<!DOCTYPE html>
<html lang="en" ng-app="listaTelefonica">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Lista telefônica</title>
    <link
      rel="stylesheet"
      href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css"
      integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh"
      crossorigin="anonymous"
    />
    <link rel="stylesheet" href="lib/bootstrap/bootstrap.css" />

    <script src="lib/angular/angular.js"></script>
    <script>
      angular.module("listaTelefonica", []); //o [] é o conjunto de modules que eu quero importar
      //abaixo estou criando o meu controller
 
      angular
        .module("listaTelefonica")
        .controller("listaTelefonicaController", function ($scope) {
          $scope.app = "Meus Contatinhos";
          $scope.contatos = [
            { nome: "Amor", telefone: "55554444", operadora: {nome: "Oi", codigo: 14} },
            { nome: "Mozão", telefone: "99998888", operadora: {nome: "Vivo", codigo: 15} },
            { nome: "Amor da minha vida", telefone: "77776666", operadora: {nome: "Tim", codigo: 41} },
          ];
          $scope.operadoras = [
            { nome: "Oi", codigo: 14, categoria: "Celular" },
            { nome: "Vivo", codigo: 15, categoria: "Celular" },
            { nome: "Tim", codigo: 41, categoria: "Celular" },
            { nome: "GVT", codigo: 25, categoria: "Fixo" },
            { nome: "Embratel", codigo: 21, categoria: "Fixo" },
          ];
          $scope.adicionarContato = function (contato) {
            $scope.contatos.push(angular.copy(contato));
            delete $scope.contato;
            $scope.contatoForm.$setPristine();
          };
          $scope.apagarContatos = function (contatos) {
            $scope.contatos = contatos.filter(function (contato) {
              if (!contato.selecionado) return contato;
            });
          };
          $scope.isContatoSelecionado = function (contatos) {
              return contatos.some(function (contato) {
                  return contato.selecionado;
              });
          };
        });
    </script>
  </head>
  <!--     A view é um lugar onde eu coloco o meu controller..."view é a comida, controller a cozinha e source o garçon"
   -->
  <body ng-controller="listaTelefonicaController">
    <div class="jumbotron">
      <h3>{{app}}</h3>
      <input class="form-control" type="text" ng-model="criterioDeBusca" placeholder="Busque por nome, telefone ou operadora" />
      <!-- posso usar tbm o ng-bind="app" -->
      <table ng-show="contatos.length > 0" class="table table-striped">
        <tr>
          <th></th>
          <th>Nome</th>
          <th>Telefone</th>
          <th>Operadora</th>
        </tr>
        <tr
          ng-class="{selecionado: contato.selecionado}"
          ng-repeat="contato in contatos | filter:criterioDeBusca | orderBy:'nome'" 
        >
          <!-- similar ao forIn -->
          <td><input type="checkbox" ng-model="contato.selecionado" /></td>
          <td>{{contato.nome}}</td>
          <td>{{contato.telefone}}</td>
          <td>{{contato.operadora.nome}}</td>
          <!-- <td ng-repeat="(key, value) in contato">
            {{value}}
          </td> -->
        </tr>
      </table>
      <hr />
      <form name="contatoForm">
          <input
            class="form-control"
            type="text"
            placeholder="Nome"
            ng-model="contato.nome"
            name="nome"
            ng-required="true"
            ng-minlength="3"
          />
          <input
            class="form-control"
            type="text"
            placeholder="Telefone"
            ng-model="contato.telefone"
            name="telefone"
            ng-required="true"
            ng-pattern="/^\d{4-5}-\d{4}$/"
          />
          <select
            class="form-control"
            ng-model="contato.operadora"
            ng-options="operadora.nome group by operadora.categoria for operadora in operadoras"
          >
            <option value="">Selecione uma operadora</option>
          </select>
      </form>
      
      <div class="alert alert-danger" ng-show="contatoForm.nome.$error.required && contatoForm.nome.$dirty">
        <p>Por favor, preencha o nome!</p>
      </div>
      <div class="alert alert-danger" ng-show="contatoForm.nome.$error.minlength">
        <p>O campo nome deve ter no mínimo 3 caracteres.</p>
      </div>
      <div class="alert alert-danger" ng-show="contatoForm.telefone.$error.required && contatoForm.telefone.$dirty">
        <p>Por favor, preencha o telefone!</p>
      </div>
      <div class="alert alert-danger" ng-show="contatoForm.telefone.$error.pattern ">
        <p>O campo telefone deve ter o formato 0000-0000.</p>
      </div>
      <button
        class="btn btn-primary btn-block"
        ng-click="adicionarContato(contato)"
        ng-disabled="contatoForm.$invalid"
      >
        Adicionar Contato
      </button>
      <button
        class="btn btn-danger btn-block"
        ng-click="apagarContatos(contatos)"
        ng-if="isContatoSelecionado(contatos)"
      >
        Deletar Contato
      </button>
    </div>
    <div ng-include="'footer.html'"></div>
  </body>
</html>

<!-- ng-bind pega algo do scope e exibe
ng-model pega algo da view e define no scope - uso no select, input e textarea -->

<!-- MANTRA: evitar ao máximo LER o scope dentro do controler! ex: adicionar os contatos ali no push passando um obj $scope.name .... -->

<!-- ng-show, ng-hide, ng-if -> para melhor performance usar o if, os outros mesmo não aparecendo dependendo da condição eles seguem existindo  -->

<!-- ng-required = diretiva de validação -->

<!-- $pristine e $dirty -> verifica se algum formulario ou campo ja foi utilizado alguma vez -->

<!-- ng-pattern -> define uma RegExp para validar um campo  -->

<!-- filtros: " | uppercase", " | lowercase", " | date:'dd/MM/yyyy HH:mm'" -->

<!-- se eu colocar "oderBy:'-nome'" fica em ordem decrescente -->